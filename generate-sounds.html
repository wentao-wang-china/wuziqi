<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>éŸ³æ•ˆç”Ÿæˆå™¨ - èµ›åšæœ‹å…‹äº”å­æ£‹</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      background: #0a0e27;
      color: #00f3ff;
      padding: 40px;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      text-shadow: 0 0 10px #00f3ff;
    }
    .container {
      background: #1a1a2e;
      padding: 30px;
      border-radius: 10px;
      border: 2px solid #00f3ff;
      box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
    }
    button {
      background: transparent;
      border: 2px solid #00f3ff;
      color: #00f3ff;
      padding: 15px 30px;
      font-size: 16px;
      font-family: 'Courier New', monospace;
      cursor: pointer;
      margin: 10px 5px;
      transition: all 0.3s;
      width: 100%;
      max-width: 300px;
      display: block;
      margin: 10px auto;
    }
    button:hover {
      background: #00f3ff;
      color: #0a0e27;
      box-shadow: 0 0 20px #00f3ff;
    }
    .info {
      margin: 20px 0;
      padding: 15px;
      background: rgba(0, 243, 255, 0.1);
      border-left: 3px solid #00f3ff;
      font-size: 14px;
    }
    .status {
      text-align: center;
      margin: 20px 0;
      font-size: 14px;
      color: #39ff14;
    }
  </style>
</head>
<body>
  <h1>ğŸµ éŸ³æ•ˆç”Ÿæˆå™¨</h1>

  <div class="container">
    <div class="info">
      <p><strong>è¯´æ˜ï¼š</strong>æ­¤å·¥å…·ä½¿ç”¨ Web Audio API ç”Ÿæˆèµ›åšæœ‹å…‹é£æ ¼çš„æ¸¸æˆéŸ³æ•ˆã€‚</p>
      <p>ç‚¹å‡»æŒ‰é’®åï¼ŒéŸ³æ•ˆå°†è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åéœ€è¦æ‰‹åŠ¨ç§»åŠ¨åˆ° <code>assets/sounds/</code> ç›®å½•ã€‚</p>
    </div>

    <button onclick="generateAndDownload('place')">ç”Ÿæˆ place.mp3ï¼ˆè½å­éŸ³æ•ˆï¼‰</button>
    <button onclick="generateAndDownload('win')">ç”Ÿæˆ win.mp3ï¼ˆèƒœåˆ©éŸ³æ•ˆï¼‰</button>
    <button onclick="generateAndDownload('click')">ç”Ÿæˆ click.mp3ï¼ˆç‚¹å‡»éŸ³æ•ˆï¼‰</button>
    <button onclick="generateAll()">ç”Ÿæˆå…¨éƒ¨éŸ³æ•ˆ</button>

    <div class="status" id="status"></div>
  </div>

  <script>
    // éŸ³é¢‘ä¸Šä¸‹æ–‡
    let audioContext = null;

    // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
    function initAudioContext() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      return audioContext;
    }

    /**
     * ç”Ÿæˆè½å­éŸ³æ•ˆï¼ˆçŸ­ä¿ƒçš„å“”å£°ï¼‰
     */
    function generatePlaceSound(context) {
      const duration = 0.1;
      const sampleRate = context.sampleRate;
      const frameCount = sampleRate * duration;
      const buffer = context.createBuffer(1, frameCount, sampleRate);
      const data = buffer.getChannelData(0);

      const frequency = 800; // 800Hz
      for (let i = 0; i < frameCount; i++) {
        const t = i / sampleRate;
        const envelope = Math.exp(-t * 20); // è¡°å‡åŒ…ç»œ
        data[i] = Math.sin(2 * Math.PI * frequency * t) * envelope * 0.3;
      }

      return buffer;
    }

    /**
     * ç”Ÿæˆèƒœåˆ©éŸ³æ•ˆï¼ˆä¸Šå‡çš„ä¸‰éŸ³ç¬¦ï¼‰
     */
    function generateWinSound(context) {
      const duration = 0.8;
      const sampleRate = context.sampleRate;
      const frameCount = sampleRate * duration;
      const buffer = context.createBuffer(1, frameCount, sampleRate);
      const data = buffer.getChannelData(0);

      const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
      const noteDuration = duration / 3;

      for (let i = 0; i < frameCount; i++) {
        const t = i / sampleRate;
        const noteIndex = Math.floor(t / noteDuration);
        const noteTime = t - noteIndex * noteDuration;

        if (noteIndex < notes.length) {
          const frequency = notes[noteIndex];
          const envelope = Math.max(0, 1 - noteTime / noteDuration);
          data[i] = Math.sin(2 * Math.PI * frequency * noteTime) * envelope * 0.3;
        }
      }

      return buffer;
    }

    /**
     * ç”Ÿæˆç‚¹å‡»éŸ³æ•ˆï¼ˆæçŸ­çš„æ»´å£°ï¼‰
     */
    function generateClickSound(context) {
      const duration = 0.05;
      const sampleRate = context.sampleRate;
      const frameCount = sampleRate * duration;
      const buffer = context.createBuffer(1, frameCount, sampleRate);
      const data = buffer.getChannelData(0);

      const frequency = 1200; // 1200Hz
      for (let i = 0; i < frameCount; i++) {
        const t = i / sampleRate;
        const envelope = Math.exp(-t * 40);
        data[i] = Math.sin(2 * Math.PI * frequency * t) * envelope * 0.2;
      }

      return buffer;
    }

    /**
     * AudioBuffer è½¬ WAV æ ¼å¼
     */
    function bufferToWav(buffer) {
      const length = buffer.length * buffer.numberOfChannels * 2;
      const arrayBuffer = new ArrayBuffer(44 + length);
      const view = new DataView(arrayBuffer);
      const channels = [];
      let offset = 0;
      let pos = 0;

      // WAV å¤´éƒ¨
      setString(view, 0, 'RIFF');
      view.setUint32(4, 36 + length, true);
      setString(view, 8, 'WAVE');
      setString(view, 12, 'fmt ');
      view.setUint32(16, 16, true);
      view.setUint16(20, 1, true);
      view.setUint16(22, buffer.numberOfChannels, true);
      view.setUint32(24, buffer.sampleRate, true);
      view.setUint32(28, buffer.sampleRate * buffer.numberOfChannels * 2, true);
      view.setUint16(32, buffer.numberOfChannels * 2, true);
      view.setUint16(34, 16, true);
      setString(view, 36, 'data');
      view.setUint32(40, length, true);

      // å†™å…¥éŸ³é¢‘æ•°æ®
      for (let i = 0; i < buffer.numberOfChannels; i++) {
        channels.push(buffer.getChannelData(i));
      }

      offset = 44;
      while (pos < buffer.length) {
        for (let i = 0; i < buffer.numberOfChannels; i++) {
          const sample = Math.max(-1, Math.min(1, channels[i][pos]));
          view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
          offset += 2;
        }
        pos++;
      }

      return arrayBuffer;
    }

    function setString(view, offset, string) {
      for (let i = 0; i < string.length; i++) {
        view.setUint8(offset + i, string.charCodeAt(i));
      }
    }

    /**
     * ä¸‹è½½éŸ³é¢‘æ–‡ä»¶
     */
    function downloadAudio(buffer, filename) {
      const wav = bufferToWav(buffer);
      const blob = new Blob([wav], { type: 'audio/wav' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();

      setTimeout(() => URL.revokeObjectURL(url), 100);
    }

    /**
     * ç”Ÿæˆå¹¶ä¸‹è½½éŸ³æ•ˆ
     */
    function generateAndDownload(type) {
      const context = initAudioContext();
      const status = document.getElementById('status');

      let buffer;
      let filename;

      switch(type) {
        case 'place':
          buffer = generatePlaceSound(context);
          filename = 'place.wav';
          break;
        case 'win':
          buffer = generateWinSound(context);
          filename = 'win.wav';
          break;
        case 'click':
          buffer = generateClickSound(context);
          filename = 'click.wav';
          break;
      }

      if (buffer) {
        downloadAudio(buffer, filename);
        status.textContent = `âœ“ ${filename} ç”ŸæˆæˆåŠŸï¼`;

        // æ’­æ”¾é¢„è§ˆ
        const source = context.createBufferSource();
        source.buffer = buffer;
        source.connect(context.destination);
        source.start();
      }
    }

    /**
     * ç”Ÿæˆå…¨éƒ¨éŸ³æ•ˆ
     */
    function generateAll() {
      const types = ['place', 'win', 'click'];
      let index = 0;

      function generateNext() {
        if (index < types.length) {
          generateAndDownload(types[index]);
          index++;
          setTimeout(generateNext, 500);
        } else {
          document.getElementById('status').textContent = 'âœ“ å…¨éƒ¨éŸ³æ•ˆç”Ÿæˆå®Œæˆï¼è¯·å°†æ–‡ä»¶ç§»åŠ¨åˆ° assets/sounds/ ç›®å½•å¹¶é‡å‘½åä¸º .mp3';
        }
      }

      generateNext();
    }
  </script>
</body>
</html>
